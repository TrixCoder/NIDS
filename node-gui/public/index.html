<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Network Intrusion Detection System</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #2c3e50;
      --secondary: #34495e;
      --accent: #3498db;
      --accent-dark: #2980b9;
      --success: #2ecc71;
      --warning: #f39c12;
      --danger: #e74c3c;
      --light: #ecf0f1;
      --dark: #2c3e50;
      --text: #333;
      --text-light: #7f8c8d;
      --border: #ddd;
      --shadow: rgba(0, 0, 0, 0.1);
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    body {
      background-color: #f5f7fa;
      color: var(--text);
      line-height: 1.6;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }
    
    header {
      background-color: var(--primary);
      color: white;
      padding: 1rem 0;
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: 0 2px 5px var(--shadow);
    }
    
    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .logo h1 {
      font-size: 1.5rem;
      font-weight: 600;
    }
    
    .logo span {
      color: var(--accent);
      font-weight: 300;
    }
    
    .status-indicator {
      display: flex;
      align-items: center;
      font-size: 0.9rem;
    }
    
    .status-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      margin-right: 8px;
      background-color: var(--danger);
    }
    
    .status-dot.connected {
      background-color: var(--success);
    }
    
    .dashboard {
      display: grid;
      grid-template-columns: 1fr;
      gap: 20px;
      padding: 20px 0;
    }
    
    .card {
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 10px var(--shadow);
      overflow: hidden;
      margin-bottom: 20px;
    }
    
    .card-header {
      background-color: var(--secondary);
      color: white;
      padding: 15px 20px;
      font-size: 1.1rem;
      font-weight: 500;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .card-body {
      padding: 20px;
    }
    
    #alerts-container {
      max-height: 70vh;
      overflow-y: auto;
      padding: 0;
    }
    
    .alert {
      padding: 15px 20px;
      border-bottom: 1px solid var(--border);
      position: relative;
    }
    
    .alert:last-child {
      border-bottom: none;
    }
    
    .alert-warning {
      border-left: 4px solid var(--warning);
    }
    
    .alert-danger {
      border-left: 4px solid var(--danger);
    }
    
    .alert-info {
      border-left: 4px solid var(--accent);
    }
    
    .alert-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    
    .alert-type {
      font-weight: 600;
      color: var(--dark);
    }
    
    .timestamp {
      font-size: 0.8rem;
      color: var(--text-light);
    }
    
    .alert-content {
      font-size: 0.95rem;
    }
    
    .alert-content .field {
      display: flex;
      margin-bottom: 5px;
    }
    
    .alert-content .field-name {
      width: 100px;
      font-weight: 500;
    }
    
    .alert-content .field-value {
      flex: 1;
      word-break: break-all;
    }
    
    .alert-actions {
      display: flex;
      justify-content: flex-end;
      margin-top: 10px;
    }
    
    .btn {
      padding: 8px 16px;
      border-radius: 4px;
      border: none;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 500;
      transition: all 0.2s;
    }
    
    .btn-sm {
      padding: 5px 10px;
      font-size: 0.8rem;
    }
    
    .btn-primary {
      background-color: var(--accent);
      color: white;
    }
    
    .btn-primary:hover {
      background-color: var(--accent-dark);
    }
    
    .btn-danger {
      background-color: var(--danger);
      color: white;
    }
    
    .btn-danger:hover {
      opacity: 0.9;
    }
    
    .btn-outline {
      background: none;
      border: 1px solid var(--border);
    }
    
    .btn-outline:hover {
      background-color: var(--light);
    }
    
    .filter-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }
    
    .search-container {
      position: relative;
      flex: 1;
      max-width: 300px;
    }
    
    .search-container i {
      position: absolute;
      top: 50%;
      left: 10px;
      transform: translateY(-50%);
      color: var(--text-light);
    }
    
    .search-input {
      width: 100%;
      padding: 8px 10px 8px 35px;
      border-radius: 4px;
      border: 1px solid var(--border);
      font-size: 0.9rem;
      transition: border-color 0.2s;
    }
    
    .search-input:focus {
      outline: none;
      border-color: var(--accent);
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 15px;
      margin-bottom: 20px;
    }
    
    .stat-card {
      padding: 15px;
      text-align: center;
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 2px 5px var(--shadow);
    }
    
    .stat-value {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--accent);
      margin: 10px 0 5px;
    }

    .cwhite{
      color: white;
    }
    
    .stat-label {
      font-size: 0.9rem;
      color: var(--text-light);
    }
    
    @media (max-width: 768px) {
      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .filter-bar {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
      }
      
      .search-container {
        max-width: 100%;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="container header-content">
      <div class="logo">
        <h1>NIDS <span>Dashboard</span></h1>
      </div>
      <div class="status-indicator">
        <div id="status-dot" class="status-dot"></div>
        <span id="status-text">Connecting...</span>
      </div>
    </div>
  </header>

  <div class="container">
    <div class="dashboard">
      <div class="card">
        <div class="card-header">
          <span>Live Network Alerts</span>
          <div class="card-header-actions">
            <button id="clear-alerts-btn" class="btn btn-sm btn-outline cwhite"><i class="fas fa-trash-alt"></i> Clear</button>
          </div>
        </div>
        <div class="filter-bar card-body">
          <div class="search-container">
            <i class="fas fa-search"></i>
            <input type="text" id="search-alerts" class="search-input" placeholder="Search alerts...">
          </div>
          <div class="filter-group">
            <select id="filter-type" class="btn btn-outline">
              <option value="all">All Types</option>
              <option value="Port Scan Detected">Port Scan</option>
              <option value="NULL Scan Detected">NULL Scan</option>
              <option value="Xmas Scan Detected">Xmas Scan</option>
            </select>
            <select id="filter-time" class="btn btn-outline">
              <option value="all">All Time</option>
              <option value="1h">Last Hour</option>
              <option value="24h">Last 24 Hours</option>
              <option value="7d">Last 7 Days</option>
            </select>
          </div>
        </div>
        <div id="alerts-container"></div>
      </div>
      
      <div class="card">
        <div class="card-header">
          <span>Network Statistics</span>
        </div>
        <div class="card-body">
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-value" id="total-alerts">0</div>
              <div class="stat-label">Total Alerts</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="blocked-ips">0</div>
              <div class="stat-label">Blocked IPs</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="port-scans">0</div>
              <div class="stat-label">Port Scans</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="other-scans">0</div>
              <div class="stat-label">Other Scans</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    // DOM Elements
    const alertsContainer = document.getElementById('alerts-container');
    const statusDot = document.getElementById('status-dot');
    const statusText = document.getElementById('status-text');
    const clearAlertsBtn = document.getElementById('clear-alerts-btn');
    const searchInput = document.getElementById('search-alerts');
    const filterType = document.getElementById('filter-type');
    const filterTime = document.getElementById('filter-time');
    const totalAlertsCounter = document.getElementById('total-alerts');
    const blockedIpsCounter = document.getElementById('blocked-ips');
    const portScansCounter = document.getElementById('port-scans');
    const otherScansCounter = document.getElementById('other-scans');

    // Alert storage
    const maxAlerts = 100;
    let alerts = [];
    let blockedIps = new Set();

    // Statistics
    let stats = {
      totalAlerts: 0,
      blockedIps: 0,
      portScans: 0,
      otherScans: 0
    };

    // Socket.IO setup
    const socket = io();

    socket.on('connect', () => {
      statusDot.classList.add('connected');
      statusText.textContent = 'Connected to NIDS';
      console.log('Socket.IO connected successfully');
    });

    socket.on('disconnect', () => {
      statusDot.classList.remove('connected');
      statusText.textContent = 'Disconnected';
      console.log('Socket.IO disconnected');
    });

    socket.on('connect_error', (err) => {
      statusDot.classList.remove('connected');
      statusText.textContent = 'Connection Error';
      console.error('Socket.IO connection error:', err);
    });

    socket.on('display_packet', (data) => {
      console.log('Received alert data:', data);
      processAlert(data);
    });
    
    socket.on('ip_blocked', (data) => {
      if (data && data.ip) {
        blockedIps.add(data.ip);
        updateStats();
      }
    });
    
    socket.on('ip_unblocked', (data) => {
      if (data && data.ip && blockedIps.has(data.ip)) {
        blockedIps.delete(data.ip);
        updateStats();
      }
    });

    // Process and display alert
    function processAlert(data) {
      // Update stats
      stats.totalAlerts++;
      if (data.type && data.type.toLowerCase().includes('port scan')) {
        stats.portScans++;
      } else if (data.type && (data.type.toLowerCase().includes('null scan') || data.type.toLowerCase().includes('xmas scan'))) {
        stats.otherScans++;
      }
      
      updateStats();
      
      // Add to alerts array
      alerts.unshift(data);
      if (alerts.length > maxAlerts) {
        alerts.pop();
      }
      
      // Re-render all alerts (with filters applied)
      renderAlerts();
    }

    function renderAlerts() {
      // Clear container
      alertsContainer.innerHTML = '';
      
      // Get filter values
      const searchTerm = searchInput.value.toLowerCase();
      const typeFilter = filterType.value;
      const timeFilter = filterTime.value;
      
      // Calculate time threshold for time filter
      let timeThreshold = null;
      if (timeFilter !== 'all') {
        const now = new Date();
        if (timeFilter === '1h') {
          timeThreshold = new Date(now.getTime() - 60 * 60 * 1000);
        } else if (timeFilter === '24h') {
          timeThreshold = new Date(now.getTime() - 24 * 60 * 60 * 1000);
        } else if (timeFilter === '7d') {
          timeThreshold = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
        }
      }
      
      // Filter and render alerts
      let filteredAlerts = alerts.filter(alert => {
        // Search filter
        let matchesSearch = true;
        if (searchTerm) {
          const alertText = JSON.stringify(alert).toLowerCase();
          matchesSearch = alertText.includes(searchTerm);
        }
        
        // Type filter
        let matchesType = true;
        if (typeFilter !== 'all') {
          matchesType = alert.type === typeFilter;
        }
        
        // Time filter
        let matchesTime = true;
        if (timeThreshold) {
          const alertTime = new Date(alert.timestamp);
          matchesTime = alertTime >= timeThreshold;
        }
        
        return matchesSearch && matchesType && matchesTime;
      });
      
      if (filteredAlerts.length === 0) {
        const emptyState = document.createElement('div');
        emptyState.className = 'card-body';
        emptyState.innerHTML = '<p style="text-align: center; color: var(--text-light);">No alerts match the current filters</p>';
        alertsContainer.appendChild(emptyState);
        return;
      }
      
      // Render each alert
      filteredAlerts.forEach(alert => {
        const alertDiv = createAlertElement(alert);
        alertsContainer.appendChild(alertDiv);
      });
    }

    function createAlertElement(data) {
      const alertDiv = document.createElement('div');
      alertDiv.className = 'alert';
      
      // Add appropriate class based on alert type
      if (data.type && data.type.toLowerCase().includes('scan')) {
        alertDiv.classList.add('alert-warning');
      } else {
        alertDiv.classList.add('alert-info');
      }
      
      // Alert header with type and timestamp
      const headerDiv = document.createElement('div');
      headerDiv.className = 'alert-header';
      
      const typeSpan = document.createElement('span');
      typeSpan.className = 'alert-type';
      typeSpan.textContent = data.type || 'Unknown Alert';
      
      const timestampSpan = document.createElement('span');
      timestampSpan.className = 'timestamp';
      timestampSpan.textContent = data.timestamp || new Date().toLocaleTimeString();
      
      headerDiv.appendChild(typeSpan);
      headerDiv.appendChild(timestampSpan);
      
      // Alert content
      const contentDiv = document.createElement('div');
      contentDiv.className = 'alert-content';
      
      // Add fields
      if (data.source_ip) {
        const field = createField('Source IP:', data.source_ip);
        contentDiv.appendChild(field);
      }
      
      if (data.target_port) {
        const field = createField('Target Port:', data.target_port);
        contentDiv.appendChild(field);
      }
      
      if (data.details) {
        const field = createField('Details:', data.details);
        contentDiv.appendChild(field);
      }
      
      // Alert actions
      const actionsDiv = document.createElement('div');
      actionsDiv.className = 'alert-actions';
      
      if (data.source_ip) {
        // Check if IP is already blocked
        const isBlocked = blockedIps.has(data.source_ip);
        
        const blockBtn = document.createElement('button');
        blockBtn.className = isBlocked ? 'btn btn-sm btn-outline' : 'btn btn-sm btn-danger';
        blockBtn.textContent = isBlocked ? 'Unblock IP' : 'Block IP';
        blockBtn.addEventListener('click', () => {
          if (isBlocked) {
            socket.emit('unblock_ip', { ip: data.source_ip });
          } else {
            socket.emit('block_ip', { 
              ip: data.source_ip, 
              reason: data.type || 'Manually blocked' 
            });
          }
        });
        
        actionsDiv.appendChild(blockBtn);
      }
      
      // Assemble the alert
      alertDiv.appendChild(headerDiv);
      alertDiv.appendChild(contentDiv);
      alertDiv.appendChild(actionsDiv);
      
      return alertDiv;
    }

    function createField(name, value) {
      const field = document.createElement('div');
      field.className = 'field';
      
      const fieldName = document.createElement('div');
      fieldName.className = 'field-name';
      fieldName.textContent = name;
      
      const fieldValue = document.createElement('div');
      fieldValue.className = 'field-value';
      fieldValue.textContent = value;
      
      field.appendChild(fieldName);
      field.appendChild(fieldValue);
      
      return field;
    }

    function updateStats() {
      totalAlertsCounter.textContent = stats.totalAlerts;
      blockedIpsCounter.textContent = blockedIps.size;
      portScansCounter.textContent = stats.portScans;
      otherScansCounter.textContent = stats.otherScans;
    }

    // Event listeners
    clearAlertsBtn.addEventListener('click', () => {
      alerts = [];
      renderAlerts();
    });

    searchInput.addEventListener('input', renderAlerts);
    filterType.addEventListener('change', renderAlerts);
    filterTime.addEventListener('change', renderAlerts);

    // Initialize
    renderAlerts();
    updateStats();
  </script>
</body>
</html>